{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "collapsed": true,
    "deletable": true,
    "editable": true
   },
   "outputs": [],
   "source": [
    "from __future__ import absolute_import, unicode_literals\n",
    "\n",
    "import hashlib\n",
    "import json\n",
    "import time\n",
    "import traceback\n",
    "from pprint import pprint\n",
    "import requests\n",
    "from celery import Celery, Task, platforms\n",
    "from celery.schedules import crontab\n",
    "from pymongo import MongoClient, ReturnDocument\n",
    "\n",
    "import conf\n",
    "class SpiderTask():\n",
    "    #: If :const:`True` the task is an abstract base class.\n",
    "    abstract = True\n",
    "    _pro = None\n",
    "    _stg = None\n",
    "    _dev = None\n",
    "\n",
    "    @property\n",
    "    def pro(self):\n",
    "        if self._pro is None:\n",
    "            _pro = MongoClient(conf.PRO_MONGO_HOST, replicaset=conf.REPLICASET_NAME)\n",
    "            self._pro = _pro[\"boluome\"]\n",
    "        return self._pro\n",
    "\n",
    "    @property\n",
    "    def stg(self):\n",
    "        if self._stg is None:\n",
    "            _stg = MongoClient(conf.STG_MONGO_HOST, replicaset=conf.REPLICASET_NAME)\n",
    "            self._stg = _stg[\"boluome\"]\n",
    "        return self._stg\n",
    "\n",
    "    @property\n",
    "    def dev(self):\n",
    "        if self._dev is None:\n",
    "            _dev = MongoClient(conf.DEV_MONGO_HOST, replicaset=conf.REPLICASET_NAME)\n",
    "            self._dev = _dev[\"boluome\"]\n",
    "        return self._dev\n",
    "self=SpiderTask()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "metadata": {
    "collapsed": true,
    "deletable": true,
    "editable": true
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "{'201612923260': [{'activityId': '',\n",
      "                   'cinemaId': '020355',\n",
      "                   'cinemaName': '博纳国际影城-万寿路店',\n",
      "                   'dimensional': '2D',\n",
      "                   'duration': '104',\n",
      "                   'feePrice': '3.00',\n",
      "                   'filmId': '201612923260',\n",
      "                   'filmName': '夜色撩人',\n",
      "                   'hallId': '6',\n",
      "                   'hallName': '6号厅',\n",
      "                   'isDiscount': 'n',\n",
      "                   'language': '国语',\n",
      "                   'merPrice': '48.00',\n",
      "                   'showDate': '2017-03-29',\n",
      "                   'showId': '020831929253',\n",
      "                   'showTime': '2240',\n",
      "                   'staPrice': '100',\n",
      "                   'userPrice': '51.00'}],\n",
      " '201701750370': [{'activityId': '',\n",
      "                   'cinemaId': '020355',\n",
      "                   'cinemaName': '博纳国际影城-万寿路店',\n",
      "                   'dimensional': '2D',\n",
      "                   'duration': '87',\n",
      "                   'feePrice': '3.00',\n",
      "                   'filmId': '201701750370',\n",
      "                   'filmName': '欢乐喜剧人',\n",
      "                   'hallId': '5',\n",
      "                   'hallName': '5号厅',\n",
      "                   'isDiscount': 'n',\n",
      "                   'language': '国语',\n",
      "                   'merPrice': '48.00',\n",
      "                   'showDate': '2017-03-29',\n",
      "                   'showId': '020831929259',\n",
      "                   'showTime': '2040',\n",
      "                   'staPrice': '100.0',\n",
      "                   'userPrice': '51.00'}],\n",
      " '201702148770': [{'activityId': '',\n",
      "                   'cinemaId': '020355',\n",
      "                   'cinemaName': '博纳国际影城-万寿路店',\n",
      "                   'dimensional': '3D',\n",
      "                   'duration': '108',\n",
      "                   'feePrice': '3.00',\n",
      "                   'filmId': '201702148770',\n",
      "                   'filmName': '欢乐好声音',\n",
      "                   'hallId': '3',\n",
      "                   'hallName': '3号厅',\n",
      "                   'isDiscount': 'n',\n",
      "                   'language': '英语',\n",
      "                   'merPrice': '58.00',\n",
      "                   'showDate': '2017-03-29',\n",
      "                   'showId': '020836227534',\n",
      "                   'showTime': '1015',\n",
      "                   'staPrice': '110.0',\n",
      "                   'userPrice': '61.00'},\n",
      "                  {'activityId': '',\n",
      "                   'cinemaId': '020355',\n",
      "                   'cinemaName': '博纳国际影城-万寿路店',\n",
      "                   'dimensional': '3D',\n",
      "                   'duration': '108',\n",
      "                   'feePrice': '3.00',\n",
      "                   'filmId': '201702148770',\n",
      "                   'filmName': '欢乐好声音',\n",
      "                   'hallId': '5',\n",
      "                   'hallName': '5号厅',\n",
      "                   'isDiscount': 'n',\n",
      "                   'language': '英语',\n",
      "                   'merPrice': '58.00',\n",
      "                   'showDate': '2017-03-29',\n",
      "                   'showId': '020836227535',\n",
      "                   'showTime': '1110',\n",
      "                   'staPrice': '110.0',\n",
      "                   'userPrice': '61.00'},\n",
      "                  {'activityId': '',\n",
      "                   'cinemaId': '020355',\n",
      "                   'cinemaName': '博纳国际影城-万寿路店',\n",
      "                   'dimensional': '3D',\n",
      "                   'duration': '108',\n",
      "                   'feePrice': '3.00',\n",
      "                   'filmId': '201702148770',\n",
      "                   'filmName': '欢乐好声音',\n",
      "                   'hallId': '3',\n",
      "                   'hallName': '3号厅',\n",
      "                   'isDiscount': 'n',\n",
      "                   'language': '英语',\n",
      "                   'merPrice': '58.00',\n",
      "                   'showDate': '2017-03-29',\n",
      "                   'showId': '020831929235',\n",
      "                   'showTime': '1630',\n",
      "                   'staPrice': '110.0',\n",
      "                   'userPrice': '61.00'}],\n",
      " '201702829870': [{'activityId': '',\n",
      "                   'cinemaId': '020355',\n",
      "                   'cinemaName': '博纳国际影城-万寿路店',\n",
      "                   'dimensional': '2D',\n",
      "                   'duration': '128',\n",
      "                   'feePrice': '3.00',\n",
      "                   'filmId': '201702829870',\n",
      "                   'filmName': '爱乐之城',\n",
      "                   'hallId': '5',\n",
      "                   'hallName': '5号厅',\n",
      "                   'isDiscount': 'n',\n",
      "                   'language': '英语',\n",
      "                   'merPrice': '48.00',\n",
      "                   'showDate': '2017-03-29',\n",
      "                   'showId': '020831929249',\n",
      "                   'showTime': '1810',\n",
      "                   'staPrice': '100.0',\n",
      "                   'userPrice': '51.00'}],\n",
      " '201703446607': [{'activityId': '',\n",
      "                   'cinemaId': '020355',\n",
      "                   'cinemaName': '博纳国际影城-万寿路店',\n",
      "                   'dimensional': '2D',\n",
      "                   'duration': '123',\n",
      "                   'feePrice': '3.00',\n",
      "                   'filmId': '201703446607',\n",
      "                   'filmName': '金刚狼3：殊死一战',\n",
      "                   'hallId': '5',\n",
      "                   'hallName': '5号厅',\n",
      "                   'isDiscount': 'n',\n",
      "                   'language': '英语',\n",
      "                   'merPrice': '48.00',\n",
      "                   'showDate': '2017-03-29',\n",
      "                   'showId': '020831929263',\n",
      "                   'showTime': '1550',\n",
      "                   'staPrice': '100.0',\n",
      "                   'userPrice': '51.00'},\n",
      "                  {'activityId': '',\n",
      "                   'cinemaId': '020355',\n",
      "                   'cinemaName': '博纳国际影城-万寿路店',\n",
      "                   'dimensional': '2D',\n",
      "                   'duration': '123',\n",
      "                   'feePrice': '3.00',\n",
      "                   'filmId': '201703446607',\n",
      "                   'filmName': '金刚狼3：殊死一战',\n",
      "                   'hallId': '5',\n",
      "                   'hallName': '5号厅',\n",
      "                   'isDiscount': 'n',\n",
      "                   'language': '英语',\n",
      "                   'merPrice': '48.00',\n",
      "                   'showDate': '2017-03-29',\n",
      "                   'showId': '020831929247',\n",
      "                   'showTime': '2230',\n",
      "                   'staPrice': '100.0',\n",
      "                   'userPrice': '51.00'}],\n",
      " '201703560607': [{'activityId': '',\n",
      "                   'cinemaId': '020355',\n",
      "                   'cinemaName': '博纳国际影城-万寿路店',\n",
      "                   'dimensional': '3D',\n",
      "                   'duration': '130',\n",
      "                   'feePrice': '3.00',\n",
      "                   'filmId': '201703560607',\n",
      "                   'filmName': '美女与野兽',\n",
      "                   'hallId': '6',\n",
      "                   'hallName': '6号厅',\n",
      "                   'isDiscount': 'n',\n",
      "                   'language': '英语',\n",
      "                   'merPrice': '58.00',\n",
      "                   'showDate': '2017-03-29',\n",
      "                   'showId': '020831929254',\n",
      "                   'showTime': '1100',\n",
      "                   'staPrice': '110.0',\n",
      "                   'userPrice': '61.00'},\n",
      "                  {'activityId': '',\n",
      "                   'cinemaId': '020355',\n",
      "                   'cinemaName': '博纳国际影城-万寿路店',\n",
      "                   'dimensional': '3D',\n",
      "                   'duration': '130',\n",
      "                   'feePrice': '3.00',\n",
      "                   'filmId': '201703560607',\n",
      "                   'filmName': '美女与野兽',\n",
      "                   'hallId': '2',\n",
      "                   'hallName': '2号厅',\n",
      "                   'isDiscount': 'n',\n",
      "                   'language': '英语',\n",
      "                   'merPrice': '58.00',\n",
      "                   'showDate': '2017-03-29',\n",
      "                   'showId': '020831929237',\n",
      "                   'showTime': '1205',\n",
      "                   'staPrice': '110',\n",
      "                   'userPrice': '61.00'},\n",
      "                  {'activityId': '',\n",
      "                   'cinemaId': '020355',\n",
      "                   'cinemaName': '博纳国际影城-万寿路店',\n",
      "                   'dimensional': '3D',\n",
      "                   'duration': '130',\n",
      "                   'feePrice': '3.00',\n",
      "                   'filmId': '201703560607',\n",
      "                   'filmName': '美女与野兽',\n",
      "                   'hallId': '5',\n",
      "                   'hallName': '5号厅',\n",
      "                   'isDiscount': 'n',\n",
      "                   'language': '英语',\n",
      "                   'merPrice': '58.00',\n",
      "                   'showDate': '2017-03-29',\n",
      "                   'showId': '020831929250',\n",
      "                   'showTime': '1315',\n",
      "                   'staPrice': '110.0',\n",
      "                   'userPrice': '61.00'},\n",
      "                  {'activityId': '',\n",
      "                   'cinemaId': '020355',\n",
      "                   'cinemaName': '博纳国际影城-万寿路店',\n",
      "                   'dimensional': '3D',\n",
      "                   'duration': '130',\n",
      "                   'feePrice': '3.00',\n",
      "                   'filmId': '201703560607',\n",
      "                   'filmName': '美女与野兽',\n",
      "                   'hallId': '2',\n",
      "                   'hallName': '2号厅',\n",
      "                   'isDiscount': 'n',\n",
      "                   'language': '英语',\n",
      "                   'merPrice': '58.00',\n",
      "                   'showDate': '2017-03-29',\n",
      "                   'showId': '020831929246',\n",
      "                   'showTime': '1435',\n",
      "                   'staPrice': '110.0',\n",
      "                   'userPrice': '61.00'},\n",
      "                  {'activityId': '',\n",
      "                   'cinemaId': '020355',\n",
      "                   'cinemaName': '博纳国际影城-万寿路店',\n",
      "                   'dimensional': '3D',\n",
      "                   'duration': '130',\n",
      "                   'feePrice': '3.00',\n",
      "                   'filmId': '201703560607',\n",
      "                   'filmName': '美女与野兽',\n",
      "                   'hallId': '6',\n",
      "                   'hallName': '6号厅',\n",
      "                   'isDiscount': 'n',\n",
      "                   'language': '英语',\n",
      "                   'merPrice': '58.00',\n",
      "                   'showDate': '2017-03-29',\n",
      "                   'showId': '020831929244',\n",
      "                   'showTime': '1535',\n",
      "                   'staPrice': '110.0',\n",
      "                   'userPrice': '61.00'},\n",
      "                  {'activityId': '',\n",
      "                   'cinemaId': '020355',\n",
      "                   'cinemaName': '博纳国际影城-万寿路店',\n",
      "                   'dimensional': '3D',\n",
      "                   'duration': '130',\n",
      "                   'feePrice': '3.00',\n",
      "                   'filmId': '201703560607',\n",
      "                   'filmName': '美女与野兽',\n",
      "                   'hallId': '2',\n",
      "                   'hallName': '2号厅',\n",
      "                   'isDiscount': 'n',\n",
      "                   'language': '英语',\n",
      "                   'merPrice': '58.00',\n",
      "                   'showDate': '2017-03-29',\n",
      "                   'showId': '020831929266',\n",
      "                   'showTime': '1700',\n",
      "                   'staPrice': '110.0',\n",
      "                   'userPrice': '61.00'},\n",
      "                  {'activityId': '',\n",
      "                   'cinemaId': '020355',\n",
      "                   'cinemaName': '博纳国际影城-万寿路店',\n",
      "                   'dimensional': '3D',\n",
      "                   'duration': '130',\n",
      "                   'feePrice': '3.00',\n",
      "                   'filmId': '201703560607',\n",
      "                   'filmName': '美女与野兽',\n",
      "                   'hallId': '2',\n",
      "                   'hallName': '2号厅',\n",
      "                   'isDiscount': 'n',\n",
      "                   'language': '英语',\n",
      "                   'merPrice': '58.00',\n",
      "                   'showDate': '2017-03-29',\n",
      "                   'showId': '020831929242',\n",
      "                   'showTime': '1925',\n",
      "                   'staPrice': '110.0',\n",
      "                   'userPrice': '61.00'},\n",
      "                  {'activityId': '',\n",
      "                   'cinemaId': '020355',\n",
      "                   'cinemaName': '博纳国际影城-万寿路店',\n",
      "                   'dimensional': '3D',\n",
      "                   'duration': '130',\n",
      "                   'feePrice': '3.00',\n",
      "                   'filmId': '201703560607',\n",
      "                   'filmName': '美女与野兽',\n",
      "                   'hallId': '6',\n",
      "                   'hallName': '6号厅',\n",
      "                   'isDiscount': 'n',\n",
      "                   'language': '英语',\n",
      "                   'merPrice': '58.00',\n",
      "                   'showDate': '2017-03-29',\n",
      "                   'showId': '020836227536',\n",
      "                   'showTime': '2010',\n",
      "                   'staPrice': '110.0',\n",
      "                   'userPrice': '61.00'},\n",
      "                  {'activityId': '',\n",
      "                   'cinemaId': '020355',\n",
      "                   'cinemaName': '博纳国际影城-万寿路店',\n",
      "                   'dimensional': '3D',\n",
      "                   'duration': '130',\n",
      "                   'feePrice': '3.00',\n",
      "                   'filmId': '201703560607',\n",
      "                   'filmName': '美女与野兽',\n",
      "                   'hallId': '2',\n",
      "                   'hallName': '2号厅',\n",
      "                   'isDiscount': 'n',\n",
      "                   'language': '英语',\n",
      "                   'merPrice': '58.00',\n",
      "                   'showDate': '2017-03-29',\n",
      "                   'showId': '020831929262',\n",
      "                   'showTime': '2150',\n",
      "                   'staPrice': '110.0',\n",
      "                   'userPrice': '61.00'}],\n",
      " '201703616507': [{'activityId': '',\n",
      "                   'cinemaId': '020355',\n",
      "                   'cinemaName': '博纳国际影城-万寿路店',\n",
      "                   'dimensional': '3D',\n",
      "                   'duration': '119',\n",
      "                   'feePrice': '3.00',\n",
      "                   'filmId': '201703616507',\n",
      "                   'filmName': '金刚：骷髅岛',\n",
      "                   'hallId': '4',\n",
      "                   'hallName': '4号厅',\n",
      "                   'isDiscount': 'n',\n",
      "                   'language': '英语',\n",
      "                   'merPrice': '58.00',\n",
      "                   'showDate': '2017-03-29',\n",
      "                   'showId': '020831929256',\n",
      "                   'showTime': '1020',\n",
      "                   'staPrice': '110.0',\n",
      "                   'userPrice': '61.00'},\n",
      "                  {'activityId': '',\n",
      "                   'cinemaId': '020355',\n",
      "                   'cinemaName': '博纳国际影城-万寿路店',\n",
      "                   'dimensional': '3D',\n",
      "                   'duration': '119',\n",
      "                   'feePrice': '3.00',\n",
      "                   'filmId': '201703616507',\n",
      "                   'filmName': '金刚：骷髅岛',\n",
      "                   'hallId': '1',\n",
      "                   'hallName': '1号厅',\n",
      "                   'isDiscount': 'n',\n",
      "                   'language': '英语',\n",
      "                   'merPrice': '58.00',\n",
      "                   'showDate': '2017-03-29',\n",
      "                   'showId': '020831929231',\n",
      "                   'showTime': '1120',\n",
      "                   'staPrice': '110.0',\n",
      "                   'userPrice': '61.00'},\n",
      "                  {'activityId': '',\n",
      "                   'cinemaId': '020355',\n",
      "                   'cinemaName': '博纳国际影城-万寿路店',\n",
      "                   'dimensional': '3D',\n",
      "                   'duration': '119',\n",
      "                   'feePrice': '3.00',\n",
      "                   'filmId': '201703616507',\n",
      "                   'filmName': '金刚：骷髅岛',\n",
      "                   'hallId': '4',\n",
      "                   'hallName': '4号厅',\n",
      "                   'isDiscount': 'n',\n",
      "                   'language': '英语',\n",
      "                   'merPrice': '58.00',\n",
      "                   'showDate': '2017-03-29',\n",
      "                   'showId': '020831929238',\n",
      "                   'showTime': '1235',\n",
      "                   'staPrice': '110.0',\n",
      "                   'userPrice': '61.00'},\n",
      "                  {'activityId': '',\n",
      "                   'cinemaId': '020355',\n",
      "                   'cinemaName': '博纳国际影城-万寿路店',\n",
      "                   'dimensional': '3D',\n",
      "                   'duration': '119',\n",
      "                   'feePrice': '3.00',\n",
      "                   'filmId': '201703616507',\n",
      "                   'filmName': '金刚：骷髅岛',\n",
      "                   'hallId': '1',\n",
      "                   'hallName': '1号厅',\n",
      "                   'isDiscount': 'n',\n",
      "                   'language': '英语',\n",
      "                   'merPrice': '58.00',\n",
      "                   'showDate': '2017-03-29',\n",
      "                   'showId': '020831929261',\n",
      "                   'showTime': '1340',\n",
      "                   'staPrice': '110.0',\n",
      "                   'userPrice': '61.00'},\n",
      "                  {'activityId': '',\n",
      "                   'cinemaId': '020355',\n",
      "                   'cinemaName': '博纳国际影城-万寿路店',\n",
      "                   'dimensional': '3D',\n",
      "                   'duration': '119',\n",
      "                   'feePrice': '3.00',\n",
      "                   'filmId': '201703616507',\n",
      "                   'filmName': '金刚：骷髅岛',\n",
      "                   'hallId': '3',\n",
      "                   'hallName': '3号厅',\n",
      "                   'isDiscount': 'n',\n",
      "                   'language': '英语',\n",
      "                   'merPrice': '58.00',\n",
      "                   'showDate': '2017-03-29',\n",
      "                   'showId': '020835691834',\n",
      "                   'showTime': '1415',\n",
      "                   'staPrice': '110.0',\n",
      "                   'userPrice': '61.00'},\n",
      "                  {'activityId': '',\n",
      "                   'cinemaId': '020355',\n",
      "                   'cinemaName': '博纳国际影城-万寿路店',\n",
      "                   'dimensional': '3D',\n",
      "                   'duration': '119',\n",
      "                   'feePrice': '3.00',\n",
      "                   'filmId': '201703616507',\n",
      "                   'filmName': '金刚：骷髅岛',\n",
      "                   'hallId': '4',\n",
      "                   'hallName': '4号厅',\n",
      "                   'isDiscount': 'n',\n",
      "                   'language': '英语',\n",
      "                   'merPrice': '58.00',\n",
      "                   'showDate': '2017-03-29',\n",
      "                   'showId': '020831929257',\n",
      "                   'showTime': '1450',\n",
      "                   'staPrice': '110.0',\n",
      "                   'userPrice': '61.00'},\n",
      "                  {'activityId': '',\n",
      "                   'cinemaId': '020355',\n",
      "                   'cinemaName': '博纳国际影城-万寿路店',\n",
      "                   'dimensional': '3D',\n",
      "                   'duration': '119',\n",
      "                   'feePrice': '3.00',\n",
      "                   'filmId': '201703616507',\n",
      "                   'filmName': '金刚：骷髅岛',\n",
      "                   'hallId': '1',\n",
      "                   'hallName': '1号厅',\n",
      "                   'isDiscount': 'n',\n",
      "                   'language': '英语',\n",
      "                   'merPrice': '58.00',\n",
      "                   'showDate': '2017-03-29',\n",
      "                   'showId': '020831929233',\n",
      "                   'showTime': '1600',\n",
      "                   'staPrice': '110.0',\n",
      "                   'userPrice': '61.00'},\n",
      "                  {'activityId': '',\n",
      "                   'cinemaId': '020355',\n",
      "                   'cinemaName': '博纳国际影城-万寿路店',\n",
      "                   'dimensional': '3D',\n",
      "                   'duration': '119',\n",
      "                   'feePrice': '3.00',\n",
      "                   'filmId': '201703616507',\n",
      "                   'filmName': '金刚：骷髅岛',\n",
      "                   'hallId': '4',\n",
      "                   'hallName': '4号厅',\n",
      "                   'isDiscount': 'n',\n",
      "                   'language': '英语',\n",
      "                   'merPrice': '58.00',\n",
      "                   'showDate': '2017-03-29',\n",
      "                   'showId': '020831929243',\n",
      "                   'showTime': '1705',\n",
      "                   'staPrice': '110.0',\n",
      "                   'userPrice': '61.00'},\n",
      "                  {'activityId': '',\n",
      "                   'cinemaId': '020355',\n",
      "                   'cinemaName': '博纳国际影城-万寿路店',\n",
      "                   'dimensional': '3D',\n",
      "                   'duration': '119',\n",
      "                   'feePrice': '3.00',\n",
      "                   'filmId': '201703616507',\n",
      "                   'filmName': '金刚：骷髅岛',\n",
      "                   'hallId': '1',\n",
      "                   'hallName': '1号厅',\n",
      "                   'isDiscount': 'n',\n",
      "                   'language': '英语',\n",
      "                   'merPrice': '58.00',\n",
      "                   'showDate': '2017-03-29',\n",
      "                   'showId': '020831929234',\n",
      "                   'showTime': '1815',\n",
      "                   'staPrice': '110.0',\n",
      "                   'userPrice': '61.00'},\n",
      "                  {'activityId': '',\n",
      "                   'cinemaId': '020355',\n",
      "                   'cinemaName': '博纳国际影城-万寿路店',\n",
      "                   'dimensional': '3D',\n",
      "                   'duration': '119',\n",
      "                   'feePrice': '3.00',\n",
      "                   'filmId': '201703616507',\n",
      "                   'filmName': '金刚：骷髅岛',\n",
      "                   'hallId': '3',\n",
      "                   'hallName': '3号厅',\n",
      "                   'isDiscount': 'n',\n",
      "                   'language': '英语',\n",
      "                   'merPrice': '58.00',\n",
      "                   'showDate': '2017-03-29',\n",
      "                   'showId': '020831929252',\n",
      "                   'showTime': '1840',\n",
      "                   'staPrice': '110.0',\n",
      "                   'userPrice': '61.00'},\n",
      "                  {'activityId': '',\n",
      "                   'cinemaId': '020355',\n",
      "                   'cinemaName': '博纳国际影城-万寿路店',\n",
      "                   'dimensional': '3D',\n",
      "                   'duration': '119',\n",
      "                   'feePrice': '3.00',\n",
      "                   'filmId': '201703616507',\n",
      "                   'filmName': '金刚：骷髅岛',\n",
      "                   'hallId': '4',\n",
      "                   'hallName': '4号厅',\n",
      "                   'isDiscount': 'n',\n",
      "                   'language': '英语',\n",
      "                   'merPrice': '58.00',\n",
      "                   'showDate': '2017-03-29',\n",
      "                   'showId': '020831929232',\n",
      "                   'showTime': '1920',\n",
      "                   'staPrice': '110.0',\n",
      "                   'userPrice': '61.00'},\n",
      "                  {'activityId': '',\n",
      "                   'cinemaId': '020355',\n",
      "                   'cinemaName': '博纳国际影城-万寿路店',\n",
      "                   'dimensional': '3D',\n",
      "                   'duration': '119',\n",
      "                   'feePrice': '3.00',\n",
      "                   'filmId': '201703616507',\n",
      "                   'filmName': '金刚：骷髅岛',\n",
      "                   'hallId': '1',\n",
      "                   'hallName': '1号厅',\n",
      "                   'isDiscount': 'n',\n",
      "                   'language': '英语',\n",
      "                   'merPrice': '58.00',\n",
      "                   'showDate': '2017-03-29',\n",
      "                   'showId': '020831929241',\n",
      "                   'showTime': '2030',\n",
      "                   'staPrice': '110.0',\n",
      "                   'userPrice': '61.00'},\n",
      "                  {'activityId': '',\n",
      "                   'cinemaId': '020355',\n",
      "                   'cinemaName': '博纳国际影城-万寿路店',\n",
      "                   'dimensional': '3D',\n",
      "                   'duration': '119',\n",
      "                   'feePrice': '3.00',\n",
      "                   'filmId': '201703616507',\n",
      "                   'filmName': '金刚：骷髅岛',\n",
      "                   'hallId': '3',\n",
      "                   'hallName': '3号厅',\n",
      "                   'isDiscount': 'n',\n",
      "                   'language': '英语',\n",
      "                   'merPrice': '58.00',\n",
      "                   'showDate': '2017-03-29',\n",
      "                   'showId': '020835691835',\n",
      "                   'showTime': '2100',\n",
      "                   'staPrice': '110.0',\n",
      "                   'userPrice': '61.00'},\n",
      "                  {'activityId': '',\n",
      "                   'cinemaId': '020355',\n",
      "                   'cinemaName': '博纳国际影城-万寿路店',\n",
      "                   'dimensional': '3D',\n",
      "                   'duration': '119',\n",
      "                   'feePrice': '3.00',\n",
      "                   'filmId': '201703616507',\n",
      "                   'filmName': '金刚：骷髅岛',\n",
      "                   'hallId': '4',\n",
      "                   'hallName': '4号厅',\n",
      "                   'isDiscount': 'n',\n",
      "                   'language': '英语',\n",
      "                   'merPrice': '58.00',\n",
      "                   'showDate': '2017-03-29',\n",
      "                   'showId': '020831929239',\n",
      "                   'showTime': '2135',\n",
      "                   'staPrice': '110.0',\n",
      "                   'userPrice': '61.00'},\n",
      "                  {'activityId': '',\n",
      "                   'cinemaId': '020355',\n",
      "                   'cinemaName': '博纳国际影城-万寿路店',\n",
      "                   'dimensional': '3D',\n",
      "                   'duration': '119',\n",
      "                   'feePrice': '3.00',\n",
      "                   'filmId': '201703616507',\n",
      "                   'filmName': '金刚：骷髅岛',\n",
      "                   'hallId': '1',\n",
      "                   'hallName': '1号厅',\n",
      "                   'isDiscount': 'n',\n",
      "                   'language': '英语',\n",
      "                   'merPrice': '58.00',\n",
      "                   'showDate': '2017-03-29',\n",
      "                   'showId': '020831929245',\n",
      "                   'showTime': '2245',\n",
      "                   'staPrice': '110.0',\n",
      "                   'userPrice': '61.00'},\n",
      "                  {'activityId': '',\n",
      "                   'cinemaId': '020355',\n",
      "                   'cinemaName': '博纳国际影城-万寿路店',\n",
      "                   'dimensional': '3D',\n",
      "                   'duration': '119',\n",
      "                   'feePrice': '3.00',\n",
      "                   'filmId': '201703616507',\n",
      "                   'filmName': '金刚：骷髅岛',\n",
      "                   'hallId': '3',\n",
      "                   'hallName': '3号厅',\n",
      "                   'isDiscount': 'n',\n",
      "                   'language': '英语',\n",
      "                   'merPrice': '58.00',\n",
      "                   'showDate': '2017-03-29',\n",
      "                   'showId': '020831929258',\n",
      "                   'showTime': '2320',\n",
      "                   'staPrice': '110.0',\n",
      "                   'userPrice': '61.00'}],\n",
      " '201703958870': [{'activityId': '',\n",
      "                   'cinemaId': '020355',\n",
      "                   'cinemaName': '博纳国际影城-万寿路店',\n",
      "                   'dimensional': '2D',\n",
      "                   'duration': '101',\n",
      "                   'feePrice': '3.00',\n",
      "                   'filmId': '201703958870',\n",
      "                   'filmName': '一条狗的使命',\n",
      "                   'hallId': '2',\n",
      "                   'hallName': '2号厅',\n",
      "                   'isDiscount': 'n',\n",
      "                   'language': '英语',\n",
      "                   'merPrice': '48.00',\n",
      "                   'showDate': '2017-03-29',\n",
      "                   'showId': '020835691833',\n",
      "                   'showTime': '1010',\n",
      "                   'staPrice': '100',\n",
      "                   'userPrice': '51.00'},\n",
      "                  {'activityId': '',\n",
      "                   'cinemaId': '020355',\n",
      "                   'cinemaName': '博纳国际影城-万寿路店',\n",
      "                   'dimensional': '2D',\n",
      "                   'duration': '101',\n",
      "                   'feePrice': '3.00',\n",
      "                   'filmId': '201703958870',\n",
      "                   'filmName': '一条狗的使命',\n",
      "                   'hallId': '3',\n",
      "                   'hallName': '3号厅',\n",
      "                   'isDiscount': 'n',\n",
      "                   'language': '英语',\n",
      "                   'merPrice': '48.00',\n",
      "                   'showDate': '2017-03-29',\n",
      "                   'showId': '020831929267',\n",
      "                   'showTime': '1220',\n",
      "                   'staPrice': '100',\n",
      "                   'userPrice': '51.00'},\n",
      "                  {'activityId': '',\n",
      "                   'cinemaId': '020355',\n",
      "                   'cinemaName': '博纳国际影城-万寿路店',\n",
      "                   'dimensional': '2D',\n",
      "                   'duration': '101',\n",
      "                   'feePrice': '3.00',\n",
      "                   'filmId': '201703958870',\n",
      "                   'filmName': '一条狗的使命',\n",
      "                   'hallId': '6',\n",
      "                   'hallName': '6号厅',\n",
      "                   'isDiscount': 'n',\n",
      "                   'language': '英语',\n",
      "                   'merPrice': '48.00',\n",
      "                   'showDate': '2017-03-29',\n",
      "                   'showId': '020831929251',\n",
      "                   'showTime': '1335',\n",
      "                   'staPrice': '100.0',\n",
      "                   'userPrice': '51.00'},\n",
      "                  {'activityId': '',\n",
      "                   'cinemaId': '020355',\n",
      "                   'cinemaName': '博纳国际影城-万寿路店',\n",
      "                   'dimensional': '2D',\n",
      "                   'duration': '101',\n",
      "                   'feePrice': '3.00',\n",
      "                   'filmId': '201703958870',\n",
      "                   'filmName': '一条狗的使命',\n",
      "                   'hallId': '6',\n",
      "                   'hallName': '6号厅',\n",
      "                   'isDiscount': 'n',\n",
      "                   'language': '英语',\n",
      "                   'merPrice': '48.00',\n",
      "                   'showDate': '2017-03-29',\n",
      "                   'showId': '020831929264',\n",
      "                   'showTime': '1805',\n",
      "                   'staPrice': '100.0',\n",
      "                   'userPrice': '51.00'}]}\n"
     ]
    }
   ],
   "source": [
    "cinema_id_get_film_information('020355',['2017-03-29'],12)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 23,
   "metadata": {
    "collapsed": false,
    "deletable": true,
    "editable": true
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "{'__v': 3,\n",
       " '_id': ObjectId('58d9cffea69b71bc7a15ab5e'),\n",
       " 'actor': '王凯 / 张鲁一 / 林心如 / 侯明昊 / 焉栩嘉',\n",
       " 'catalog': '/剧情/悬疑',\n",
       " 'cinemaId': '020355',\n",
       " 'country': '中国',\n",
       " 'description': '<p><span style=\"LINE-HEIGHT: 19px; BACKGROUND-COLOR: rgb(255,255,255); FONT-FAMILY: Helvetica, Arial, sans-serif; COLOR: rgb(17,17,17); FONT-SIZE: 12px\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 在刑警学院任职的物理天才唐川与中学教师石泓年少相识，因彼此对数学的共同兴趣而惺惺相惜，多年后唐川在调查一桩杀人案时， 身为石泓邻居的陈婧被列入警方的“嫌疑人”之中，石泓与唐川因此再度重逢，而唐川却在调查中发现了更大的秘密……被迫站在对立面的唐川、石泓由此展开了一场高智商对决，一步步推动故事走向既震撼人心又令人扼腕的结局。</span></p>',\n",
       " 'dimensional': '2D',\n",
       " 'director': '苏有朋',\n",
       " 'duration': '109',\n",
       " 'englishName': 'Suspect X',\n",
       " 'filmId': '201612361070',\n",
       " 'filmName': '嫌疑人X的献身',\n",
       " 'language': '国语',\n",
       " 'openingDate': '2017-03-31',\n",
       " 'picture': 'http://pic.spider.com.cn/pic/filmpic/jdt/1490059368098.jpg',\n",
       " 'plans': [{'activityId': '',\n",
       "   'cinemaId': '020355',\n",
       "   'cinemaName': '博纳国际影城-万寿路店',\n",
       "   'dimensional': '2D',\n",
       "   'duration': '112',\n",
       "   'feePrice': '3.00',\n",
       "   'filmId': '201612361070',\n",
       "   'filmName': '嫌疑人X的献身',\n",
       "   'hallId': '1',\n",
       "   'hallName': '1号厅',\n",
       "   'isDiscount': 'n',\n",
       "   'language': '国语',\n",
       "   'merPrice': '48.00',\n",
       "   'showDate': '2017-04-01',\n",
       "   'showId': '020842353215',\n",
       "   'showTime': '1740',\n",
       "   'staPrice': '100.0',\n",
       "   'userPrice': '51.00'},\n",
       "  {'activityId': '',\n",
       "   'cinemaId': '020355',\n",
       "   'cinemaName': '博纳国际影城-万寿路店',\n",
       "   'dimensional': '2D',\n",
       "   'duration': '112',\n",
       "   'feePrice': '3.00',\n",
       "   'filmId': '201612361070',\n",
       "   'filmName': '嫌疑人X的献身',\n",
       "   'hallId': '1',\n",
       "   'hallName': '1号厅',\n",
       "   'isDiscount': 'n',\n",
       "   'language': '国语',\n",
       "   'merPrice': '48.00',\n",
       "   'showDate': '2017-04-01',\n",
       "   'showId': '020842353237',\n",
       "   'showTime': '1950',\n",
       "   'staPrice': '100.0',\n",
       "   'userPrice': '51.00'},\n",
       "  {'activityId': '',\n",
       "   'cinemaId': '020355',\n",
       "   'cinemaName': '博纳国际影城-万寿路店',\n",
       "   'dimensional': '2D',\n",
       "   'duration': '112',\n",
       "   'feePrice': '3.00',\n",
       "   'filmId': '201612361070',\n",
       "   'filmName': '嫌疑人X的献身',\n",
       "   'hallId': '6',\n",
       "   'hallName': '6号厅',\n",
       "   'isDiscount': 'n',\n",
       "   'language': '国语',\n",
       "   'merPrice': '48.00',\n",
       "   'showDate': '2017-04-01',\n",
       "   'showId': '020842353223',\n",
       "   'showTime': '2115',\n",
       "   'staPrice': '100.0',\n",
       "   'userPrice': '51.00'},\n",
       "  {'activityId': '',\n",
       "   'cinemaId': '020355',\n",
       "   'cinemaName': '博纳国际影城-万寿路店',\n",
       "   'dimensional': '2D',\n",
       "   'duration': '112',\n",
       "   'feePrice': '3.00',\n",
       "   'filmId': '201612361070',\n",
       "   'filmName': '嫌疑人X的献身',\n",
       "   'hallId': '6',\n",
       "   'hallName': '6号厅',\n",
       "   'isDiscount': 'n',\n",
       "   'language': '国语',\n",
       "   'merPrice': '48.00',\n",
       "   'showDate': '2017-04-01',\n",
       "   'showId': '020842353175',\n",
       "   'showTime': '2325',\n",
       "   'staPrice': '100.0',\n",
       "   'userPrice': '51.00'},\n",
       "  {'activityId': '',\n",
       "   'cinemaId': '020355',\n",
       "   'cinemaName': '博纳国际影城-万寿路店',\n",
       "   'dimensional': '2D',\n",
       "   'duration': '112',\n",
       "   'feePrice': '3.00',\n",
       "   'filmId': '201612361070',\n",
       "   'filmName': '嫌疑人X的献身',\n",
       "   'hallId': '4',\n",
       "   'hallName': '4号厅',\n",
       "   'isDiscount': 'n',\n",
       "   'language': '国语',\n",
       "   'merPrice': '48.00',\n",
       "   'showDate': '2017-04-02',\n",
       "   'showId': '020842353242',\n",
       "   'showTime': '1020',\n",
       "   'staPrice': '100.0',\n",
       "   'userPrice': '51.00'},\n",
       "  {'activityId': '',\n",
       "   'cinemaId': '020355',\n",
       "   'cinemaName': '博纳国际影城-万寿路店',\n",
       "   'dimensional': '2D',\n",
       "   'duration': '112',\n",
       "   'feePrice': '3.00',\n",
       "   'filmId': '201612361070',\n",
       "   'filmName': '嫌疑人X的献身',\n",
       "   'hallId': '6',\n",
       "   'hallName': '6号厅',\n",
       "   'isDiscount': 'n',\n",
       "   'language': '国语',\n",
       "   'merPrice': '48.00',\n",
       "   'showDate': '2017-04-02',\n",
       "   'showId': '020842353246',\n",
       "   'showTime': '1100',\n",
       "   'staPrice': '100.0',\n",
       "   'userPrice': '51.00'},\n",
       "  {'activityId': '',\n",
       "   'cinemaId': '020355',\n",
       "   'cinemaName': '博纳国际影城-万寿路店',\n",
       "   'dimensional': '2D',\n",
       "   'duration': '112',\n",
       "   'feePrice': '3.00',\n",
       "   'filmId': '201612361070',\n",
       "   'filmName': '嫌疑人X的献身',\n",
       "   'hallId': '4',\n",
       "   'hallName': '4号厅',\n",
       "   'isDiscount': 'n',\n",
       "   'language': '国语',\n",
       "   'merPrice': '48.00',\n",
       "   'showDate': '2017-04-02',\n",
       "   'showId': '020842353211',\n",
       "   'showTime': '1230',\n",
       "   'staPrice': '100.0',\n",
       "   'userPrice': '51.00'},\n",
       "  {'activityId': '',\n",
       "   'cinemaId': '020355',\n",
       "   'cinemaName': '博纳国际影城-万寿路店',\n",
       "   'dimensional': '2D',\n",
       "   'duration': '112',\n",
       "   'feePrice': '3.00',\n",
       "   'filmId': '201612361070',\n",
       "   'filmName': '嫌疑人X的献身',\n",
       "   'hallId': '4',\n",
       "   'hallName': '4号厅',\n",
       "   'isDiscount': 'n',\n",
       "   'language': '国语',\n",
       "   'merPrice': '48.00',\n",
       "   'showDate': '2017-04-02',\n",
       "   'showId': '020842353189',\n",
       "   'showTime': '1440',\n",
       "   'staPrice': '100.0',\n",
       "   'userPrice': '51.00'},\n",
       "  {'activityId': '',\n",
       "   'cinemaId': '020355',\n",
       "   'cinemaName': '博纳国际影城-万寿路店',\n",
       "   'dimensional': '2D',\n",
       "   'duration': '112',\n",
       "   'feePrice': '3.00',\n",
       "   'filmId': '201612361070',\n",
       "   'filmName': '嫌疑人X的献身',\n",
       "   'hallId': '1',\n",
       "   'hallName': '1号厅',\n",
       "   'isDiscount': 'n',\n",
       "   'language': '国语',\n",
       "   'merPrice': '48.00',\n",
       "   'showDate': '2017-04-02',\n",
       "   'showId': '020842353219',\n",
       "   'showTime': '1740',\n",
       "   'staPrice': '100.0',\n",
       "   'userPrice': '51.00'},\n",
       "  {'activityId': '',\n",
       "   'cinemaId': '020355',\n",
       "   'cinemaName': '博纳国际影城-万寿路店',\n",
       "   'dimensional': '2D',\n",
       "   'duration': '112',\n",
       "   'feePrice': '3.00',\n",
       "   'filmId': '201612361070',\n",
       "   'filmName': '嫌疑人X的献身',\n",
       "   'hallId': '1',\n",
       "   'hallName': '1号厅',\n",
       "   'isDiscount': 'n',\n",
       "   'language': '国语',\n",
       "   'merPrice': '48.00',\n",
       "   'showDate': '2017-04-02',\n",
       "   'showId': '020842353200',\n",
       "   'showTime': '1950',\n",
       "   'staPrice': '100.0',\n",
       "   'userPrice': '51.00'},\n",
       "  {'activityId': '',\n",
       "   'cinemaId': '020355',\n",
       "   'cinemaName': '博纳国际影城-万寿路店',\n",
       "   'dimensional': '2D',\n",
       "   'duration': '112',\n",
       "   'feePrice': '3.00',\n",
       "   'filmId': '201612361070',\n",
       "   'filmName': '嫌疑人X的献身',\n",
       "   'hallId': '4',\n",
       "   'hallName': '4号厅',\n",
       "   'isDiscount': 'n',\n",
       "   'language': '国语',\n",
       "   'merPrice': '48.00',\n",
       "   'showDate': '2017-04-03',\n",
       "   'showId': '020849411540',\n",
       "   'showTime': '1030',\n",
       "   'staPrice': '100.0',\n",
       "   'userPrice': '51.00'},\n",
       "  {'activityId': '',\n",
       "   'cinemaId': '020355',\n",
       "   'cinemaName': '博纳国际影城-万寿路店',\n",
       "   'dimensional': '2D',\n",
       "   'duration': '112',\n",
       "   'feePrice': '3.00',\n",
       "   'filmId': '201612361070',\n",
       "   'filmName': '嫌疑人X的献身',\n",
       "   'hallId': '4',\n",
       "   'hallName': '4号厅',\n",
       "   'isDiscount': 'n',\n",
       "   'language': '国语',\n",
       "   'merPrice': '48.00',\n",
       "   'showDate': '2017-04-03',\n",
       "   'showId': '020849411526',\n",
       "   'showTime': '1240',\n",
       "   'staPrice': '100.0',\n",
       "   'userPrice': '51.00'},\n",
       "  {'activityId': '',\n",
       "   'cinemaId': '020355',\n",
       "   'cinemaName': '博纳国际影城-万寿路店',\n",
       "   'dimensional': '2D',\n",
       "   'duration': '112',\n",
       "   'feePrice': '3.00',\n",
       "   'filmId': '201612361070',\n",
       "   'filmName': '嫌疑人X的献身',\n",
       "   'hallId': '4',\n",
       "   'hallName': '4号厅',\n",
       "   'isDiscount': 'n',\n",
       "   'language': '国语',\n",
       "   'merPrice': '48.00',\n",
       "   'showDate': '2017-04-03',\n",
       "   'showId': '020849411534',\n",
       "   'showTime': '1450',\n",
       "   'staPrice': '100.0',\n",
       "   'userPrice': '51.00'},\n",
       "  {'activityId': '',\n",
       "   'cinemaId': '020355',\n",
       "   'cinemaName': '博纳国际影城-万寿路店',\n",
       "   'dimensional': '2D',\n",
       "   'duration': '112',\n",
       "   'feePrice': '3.00',\n",
       "   'filmId': '201612361070',\n",
       "   'filmName': '嫌疑人X的献身',\n",
       "   'hallId': '1',\n",
       "   'hallName': '1号厅',\n",
       "   'isDiscount': 'n',\n",
       "   'language': '国语',\n",
       "   'merPrice': '48.00',\n",
       "   'showDate': '2017-04-03',\n",
       "   'showId': '020849411527',\n",
       "   'showTime': '1740',\n",
       "   'staPrice': '100.0',\n",
       "   'userPrice': '51.00'},\n",
       "  {'activityId': '',\n",
       "   'cinemaId': '020355',\n",
       "   'cinemaName': '博纳国际影城-万寿路店',\n",
       "   'dimensional': '2D',\n",
       "   'duration': '112',\n",
       "   'feePrice': '3.00',\n",
       "   'filmId': '201612361070',\n",
       "   'filmName': '嫌疑人X的献身',\n",
       "   'hallId': '1',\n",
       "   'hallName': '1号厅',\n",
       "   'isDiscount': 'n',\n",
       "   'language': '国语',\n",
       "   'merPrice': '48.00',\n",
       "   'showDate': '2017-04-03',\n",
       "   'showId': '020849411518',\n",
       "   'showTime': '1950',\n",
       "   'staPrice': '100.0',\n",
       "   'userPrice': '51.00'},\n",
       "  {'activityId': '',\n",
       "   'cinemaId': '020355',\n",
       "   'cinemaName': '博纳国际影城-万寿路店',\n",
       "   'dimensional': '2D',\n",
       "   'duration': '112',\n",
       "   'feePrice': '3.00',\n",
       "   'filmId': '201612361070',\n",
       "   'filmName': '嫌疑人X的献身',\n",
       "   'hallId': '4',\n",
       "   'hallName': '4号厅',\n",
       "   'isDiscount': 'n',\n",
       "   'language': '国语',\n",
       "   'merPrice': '48.00',\n",
       "   'showDate': '2017-04-04',\n",
       "   'showId': '020849538268',\n",
       "   'showTime': '1030',\n",
       "   'staPrice': '100.0',\n",
       "   'userPrice': '51.00'},\n",
       "  {'activityId': '',\n",
       "   'cinemaId': '020355',\n",
       "   'cinemaName': '博纳国际影城-万寿路店',\n",
       "   'dimensional': '2D',\n",
       "   'duration': '112',\n",
       "   'feePrice': '3.00',\n",
       "   'filmId': '201612361070',\n",
       "   'filmName': '嫌疑人X的献身',\n",
       "   'hallId': '4',\n",
       "   'hallName': '4号厅',\n",
       "   'isDiscount': 'n',\n",
       "   'language': '国语',\n",
       "   'merPrice': '48.00',\n",
       "   'showDate': '2017-04-04',\n",
       "   'showId': '020849538266',\n",
       "   'showTime': '1240',\n",
       "   'staPrice': '100.0',\n",
       "   'userPrice': '51.00'},\n",
       "  {'activityId': '',\n",
       "   'cinemaId': '020355',\n",
       "   'cinemaName': '博纳国际影城-万寿路店',\n",
       "   'dimensional': '2D',\n",
       "   'duration': '112',\n",
       "   'feePrice': '3.00',\n",
       "   'filmId': '201612361070',\n",
       "   'filmName': '嫌疑人X的献身',\n",
       "   'hallId': '4',\n",
       "   'hallName': '4号厅',\n",
       "   'isDiscount': 'n',\n",
       "   'language': '国语',\n",
       "   'merPrice': '48.00',\n",
       "   'showDate': '2017-04-04',\n",
       "   'showId': '020849538253',\n",
       "   'showTime': '1450',\n",
       "   'staPrice': '100.0',\n",
       "   'userPrice': '51.00'},\n",
       "  {'activityId': '',\n",
       "   'cinemaId': '020355',\n",
       "   'cinemaName': '博纳国际影城-万寿路店',\n",
       "   'dimensional': '2D',\n",
       "   'duration': '112',\n",
       "   'feePrice': '3.00',\n",
       "   'filmId': '201612361070',\n",
       "   'filmName': '嫌疑人X的献身',\n",
       "   'hallId': '1',\n",
       "   'hallName': '1号厅',\n",
       "   'isDiscount': 'n',\n",
       "   'language': '国语',\n",
       "   'merPrice': '48.00',\n",
       "   'showDate': '2017-04-04',\n",
       "   'showId': '020849538257',\n",
       "   'showTime': '1740',\n",
       "   'staPrice': '100.0',\n",
       "   'userPrice': '51.00'},\n",
       "  {'activityId': '',\n",
       "   'cinemaId': '020355',\n",
       "   'cinemaName': '博纳国际影城-万寿路店',\n",
       "   'dimensional': '2D',\n",
       "   'duration': '112',\n",
       "   'feePrice': '3.00',\n",
       "   'filmId': '201612361070',\n",
       "   'filmName': '嫌疑人X的献身',\n",
       "   'hallId': '1',\n",
       "   'hallName': '1号厅',\n",
       "   'isDiscount': 'n',\n",
       "   'language': '国语',\n",
       "   'merPrice': '48.00',\n",
       "   'showDate': '2017-04-04',\n",
       "   'showId': '020849538273',\n",
       "   'showTime': '1950',\n",
       "   'staPrice': '100.0',\n",
       "   'userPrice': '51.00'},\n",
       "  {'activityId': '',\n",
       "   'cinemaId': '020355',\n",
       "   'cinemaName': '博纳国际影城-万寿路店',\n",
       "   'dimensional': '2D',\n",
       "   'duration': '112',\n",
       "   'feePrice': '3.00',\n",
       "   'filmId': '201612361070',\n",
       "   'filmName': '嫌疑人X的献身',\n",
       "   'hallId': '4',\n",
       "   'hallName': '4号厅',\n",
       "   'isDiscount': 'n',\n",
       "   'language': '国语',\n",
       "   'merPrice': '48.00',\n",
       "   'showDate': '2017-04-05',\n",
       "   'showId': '020847929116',\n",
       "   'showTime': '1020',\n",
       "   'staPrice': '100.0',\n",
       "   'userPrice': '51.00'},\n",
       "  {'activityId': '',\n",
       "   'cinemaId': '020355',\n",
       "   'cinemaName': '博纳国际影城-万寿路店',\n",
       "   'dimensional': '2D',\n",
       "   'duration': '112',\n",
       "   'feePrice': '3.00',\n",
       "   'filmId': '201612361070',\n",
       "   'filmName': '嫌疑人X的献身',\n",
       "   'hallId': '6',\n",
       "   'hallName': '6号厅',\n",
       "   'isDiscount': 'n',\n",
       "   'language': '国语',\n",
       "   'merPrice': '48.00',\n",
       "   'showDate': '2017-04-05',\n",
       "   'showId': '020847929131',\n",
       "   'showTime': '1100',\n",
       "   'staPrice': '100.0',\n",
       "   'userPrice': '51.00'},\n",
       "  {'activityId': '',\n",
       "   'cinemaId': '020355',\n",
       "   'cinemaName': '博纳国际影城-万寿路店',\n",
       "   'dimensional': '2D',\n",
       "   'duration': '112',\n",
       "   'feePrice': '3.00',\n",
       "   'filmId': '201612361070',\n",
       "   'filmName': '嫌疑人X的献身',\n",
       "   'hallId': '4',\n",
       "   'hallName': '4号厅',\n",
       "   'isDiscount': 'n',\n",
       "   'language': '国语',\n",
       "   'merPrice': '48.00',\n",
       "   'showDate': '2017-04-05',\n",
       "   'showId': '020847929109',\n",
       "   'showTime': '1230',\n",
       "   'staPrice': '100.0',\n",
       "   'userPrice': '51.00'},\n",
       "  {'activityId': '',\n",
       "   'cinemaId': '020355',\n",
       "   'cinemaName': '博纳国际影城-万寿路店',\n",
       "   'dimensional': '2D',\n",
       "   'duration': '112',\n",
       "   'feePrice': '3.00',\n",
       "   'filmId': '201612361070',\n",
       "   'filmName': '嫌疑人X的献身',\n",
       "   'hallId': '4',\n",
       "   'hallName': '4号厅',\n",
       "   'isDiscount': 'n',\n",
       "   'language': '国语',\n",
       "   'merPrice': '48.00',\n",
       "   'showDate': '2017-04-05',\n",
       "   'showId': '020847929138',\n",
       "   'showTime': '1440',\n",
       "   'staPrice': '100.0',\n",
       "   'userPrice': '51.00'},\n",
       "  {'activityId': '',\n",
       "   'cinemaId': '020355',\n",
       "   'cinemaName': '博纳国际影城-万寿路店',\n",
       "   'dimensional': '2D',\n",
       "   'duration': '112',\n",
       "   'feePrice': '3.00',\n",
       "   'filmId': '201612361070',\n",
       "   'filmName': '嫌疑人X的献身',\n",
       "   'hallId': '1',\n",
       "   'hallName': '1号厅',\n",
       "   'isDiscount': 'n',\n",
       "   'language': '国语',\n",
       "   'merPrice': '48.00',\n",
       "   'showDate': '2017-04-05',\n",
       "   'showId': '020847929120',\n",
       "   'showTime': '1525',\n",
       "   'staPrice': '100.0',\n",
       "   'userPrice': '51.00'},\n",
       "  {'activityId': '',\n",
       "   'cinemaId': '020355',\n",
       "   'cinemaName': '博纳国际影城-万寿路店',\n",
       "   'dimensional': '2D',\n",
       "   'duration': '112',\n",
       "   'feePrice': '3.00',\n",
       "   'filmId': '201612361070',\n",
       "   'filmName': '嫌疑人X的献身',\n",
       "   'hallId': '4',\n",
       "   'hallName': '4号厅',\n",
       "   'isDiscount': 'n',\n",
       "   'language': '国语',\n",
       "   'merPrice': '48.00',\n",
       "   'showDate': '2017-04-05',\n",
       "   'showId': '020847929105',\n",
       "   'showTime': '1650',\n",
       "   'staPrice': '100.0',\n",
       "   'userPrice': '51.00'},\n",
       "  {'activityId': '',\n",
       "   'cinemaId': '020355',\n",
       "   'cinemaName': '博纳国际影城-万寿路店',\n",
       "   'dimensional': '2D',\n",
       "   'duration': '112',\n",
       "   'feePrice': '3.00',\n",
       "   'filmId': '201612361070',\n",
       "   'filmName': '嫌疑人X的献身',\n",
       "   'hallId': '1',\n",
       "   'hallName': '1号厅',\n",
       "   'isDiscount': 'n',\n",
       "   'language': '国语',\n",
       "   'merPrice': '48.00',\n",
       "   'showDate': '2017-04-05',\n",
       "   'showId': '020847929126',\n",
       "   'showTime': '1735',\n",
       "   'staPrice': '100.0',\n",
       "   'userPrice': '51.00'},\n",
       "  {'activityId': '',\n",
       "   'cinemaId': '020355',\n",
       "   'cinemaName': '博纳国际影城-万寿路店',\n",
       "   'dimensional': '2D',\n",
       "   'duration': '112',\n",
       "   'feePrice': '3.00',\n",
       "   'filmId': '201612361070',\n",
       "   'filmName': '嫌疑人X的献身',\n",
       "   'hallId': '5',\n",
       "   'hallName': '5号厅',\n",
       "   'isDiscount': 'n',\n",
       "   'language': '国语',\n",
       "   'merPrice': '48.00',\n",
       "   'showDate': '2017-04-05',\n",
       "   'showId': '020847929136',\n",
       "   'showTime': '1825',\n",
       "   'staPrice': '100.0',\n",
       "   'userPrice': '51.00'},\n",
       "  {'activityId': '',\n",
       "   'cinemaId': '020355',\n",
       "   'cinemaName': '博纳国际影城-万寿路店',\n",
       "   'dimensional': '2D',\n",
       "   'duration': '112',\n",
       "   'feePrice': '3.00',\n",
       "   'filmId': '201612361070',\n",
       "   'filmName': '嫌疑人X的献身',\n",
       "   'hallId': '4',\n",
       "   'hallName': '4号厅',\n",
       "   'isDiscount': 'n',\n",
       "   'language': '国语',\n",
       "   'merPrice': '48.00',\n",
       "   'showDate': '2017-04-05',\n",
       "   'showId': '020847929119',\n",
       "   'showTime': '1900',\n",
       "   'staPrice': '100.0',\n",
       "   'userPrice': '51.00'},\n",
       "  {'activityId': '',\n",
       "   'cinemaId': '020355',\n",
       "   'cinemaName': '博纳国际影城-万寿路店',\n",
       "   'dimensional': '2D',\n",
       "   'duration': '112',\n",
       "   'feePrice': '3.00',\n",
       "   'filmId': '201612361070',\n",
       "   'filmName': '嫌疑人X的献身',\n",
       "   'hallId': '1',\n",
       "   'hallName': '1号厅',\n",
       "   'isDiscount': 'n',\n",
       "   'language': '国语',\n",
       "   'merPrice': '48.00',\n",
       "   'showDate': '2017-04-05',\n",
       "   'showId': '020847929114',\n",
       "   'showTime': '1945',\n",
       "   'staPrice': '100.0',\n",
       "   'userPrice': '51.00'},\n",
       "  {'activityId': '',\n",
       "   'cinemaId': '020355',\n",
       "   'cinemaName': '博纳国际影城-万寿路店',\n",
       "   'dimensional': '2D',\n",
       "   'duration': '112',\n",
       "   'feePrice': '3.00',\n",
       "   'filmId': '201612361070',\n",
       "   'filmName': '嫌疑人X的献身',\n",
       "   'hallId': '4',\n",
       "   'hallName': '4号厅',\n",
       "   'isDiscount': 'n',\n",
       "   'language': '国语',\n",
       "   'merPrice': '48.00',\n",
       "   'showDate': '2017-04-05',\n",
       "   'showId': '020847929108',\n",
       "   'showTime': '2110',\n",
       "   'staPrice': '100.0',\n",
       "   'userPrice': '51.00'},\n",
       "  {'activityId': '',\n",
       "   'cinemaId': '020355',\n",
       "   'cinemaName': '博纳国际影城-万寿路店',\n",
       "   'dimensional': '2D',\n",
       "   'duration': '112',\n",
       "   'feePrice': '3.00',\n",
       "   'filmId': '201612361070',\n",
       "   'filmName': '嫌疑人X的献身',\n",
       "   'hallId': '1',\n",
       "   'hallName': '1号厅',\n",
       "   'isDiscount': 'n',\n",
       "   'language': '国语',\n",
       "   'merPrice': '48.00',\n",
       "   'showDate': '2017-04-05',\n",
       "   'showId': '020847929144',\n",
       "   'showTime': '2155',\n",
       "   'staPrice': '100.0',\n",
       "   'userPrice': '51.00'},\n",
       "  {'activityId': '',\n",
       "   'cinemaId': '020355',\n",
       "   'cinemaName': '博纳国际影城-万寿路店',\n",
       "   'dimensional': '2D',\n",
       "   'duration': '112',\n",
       "   'feePrice': '3.00',\n",
       "   'filmId': '201612361070',\n",
       "   'filmName': '嫌疑人X的献身',\n",
       "   'hallId': '5',\n",
       "   'hallName': '5号厅',\n",
       "   'isDiscount': 'n',\n",
       "   'language': '国语',\n",
       "   'merPrice': '48.00',\n",
       "   'showDate': '2017-04-05',\n",
       "   'showId': '020847929143',\n",
       "   'showTime': '2235',\n",
       "   'staPrice': '100.0',\n",
       "   'userPrice': '51.00'},\n",
       "  {'activityId': '',\n",
       "   'cinemaId': '020355',\n",
       "   'cinemaName': '博纳国际影城-万寿路店',\n",
       "   'dimensional': '2D',\n",
       "   'duration': '112',\n",
       "   'feePrice': '3.00',\n",
       "   'filmId': '201612361070',\n",
       "   'filmName': '嫌疑人X的献身',\n",
       "   'hallId': '4',\n",
       "   'hallName': '4号厅',\n",
       "   'isDiscount': 'n',\n",
       "   'language': '国语',\n",
       "   'merPrice': '48.00',\n",
       "   'showDate': '2017-04-05',\n",
       "   'showId': '020847929134',\n",
       "   'showTime': '2320',\n",
       "   'staPrice': '100.0',\n",
       "   'userPrice': '51.00'}],\n",
       " 'updatedAt': '2017-04-01'}"
      ]
     },
     "execution_count": 23,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "self.dev['dianying_film_zzw'].find_one({'cinemaId': '020355', '__v': {'$ne': 12}})"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {
    "collapsed": true,
    "deletable": true,
    "editable": true
   },
   "outputs": [],
   "source": [
    "def cinema_id_get_film_information(cinema_id, range_date, version):\n",
    "    datas = {}\n",
    "    for date in range_date:\n",
    "        show_url = 'http://filmapi.spider.com.cn/v2/boluomi/showList.html'\n",
    "        film_id = ''\n",
    "        hstr = \"{}{}{}{}{}\".format(cinema_id, film_id, date, conf.SPIDER_APP_KEY, conf.SPIDER_APP_SECRET)\n",
    "        sign = hashlib.md5(hstr.encode('utf-8')).hexdigest()\n",
    "        post_data = {\n",
    "            \"key\": conf.SPIDER_APP_KEY,\n",
    "            \"cinemaId\": cinema_id,\n",
    "            \"filmId\": film_id,\n",
    "            \"showDate\": date,\n",
    "            \"sign\": sign,\n",
    "            \"filetype\": \"json\"\n",
    "        }\n",
    "\n",
    "        resp = requests.post(show_url, params=post_data)\n",
    "        resp_data = resp.json()\n",
    "        show_data = resp_data['data']\n",
    "        \n",
    "        for item in show_data:\n",
    "            film_id = item['filmId']\n",
    "            datas.setdefault(film_id, [])\n",
    "            datas[film_id].append(item)\n",
    "    pprint(datas)\n",
    "    return \n",
    "    today = time.strftime(\"%Y-%m-%d\", time.localtime())\n",
    "    for key, value in datas.items():\n",
    "        self.dev['dianying_film_zzw'].update_one(\n",
    "            {'filmId': key, 'cinemaId': cinema_id},\n",
    "            {'$set': {'plans': value, 'updatedAt': today, '__v': version}},\n",
    "            upsert=True)\n",
    "        self.stg['dianying_film_zzw'].update_one(\n",
    "            {'filmId': key, 'cinemaId': cinema_id},\n",
    "            {'$set': {'plans': value, 'updatedAt': today, '__v': version}},\n",
    "            upsert=True)\n",
    "        # self.pro['dianying_film_zzw'].update_one(\n",
    "        #     {'filmId': key, 'cinemaId': cinema_id},\n",
    "        #     {'$set': {'plans': value, 'updatedAt': today, '__v': version}},\n",
    "        #     upsert=True)\n",
    "    return ['cinema_id:', cinema_id, 'is ok']"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "metadata": {
    "collapsed": false
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "{'message': '商户信息不存在', 'result': '1001'}"
      ]
     },
     "execution_count": 3,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "def city_id_fetch_schedule():\n",
    "    \"\"\"获取所有城市ID列表，调用cinema接口爬取每个城市电影院信息，存入mongo数据库\n",
    "    \"\"\"\n",
    "    city_url = 'http://filmapi.spider.com.cn/v2/boluomi/cityList.html'\n",
    "    resp = None\n",
    "    hstr = \"{}{}\".format(conf.SPIDER_APP_KEY, conf.SPIDER_APP_SECRET)\n",
    "    sign = hashlib.md5(hstr.encode('utf-8')).hexdigest()\n",
    "    post_data = {\"key\": conf.SPIDER_APP_KEY, \"sign\": sign, \"filetype\": \"json\"}\n",
    "    try:\n",
    "        resp = requests.post(city_url, params=post_data)\n",
    "        resp_data = resp.json()\n",
    "        return resp_data\n",
    "        city_data = resp_data['data']\n",
    "    except KeyError as e:\n",
    "        raise self.retry(exc=e, countdown=30)\n",
    "\n",
    "    version = int((int(time.time()) - 1490701967) / 3600 / 24)  # 按日递增版本号v1\n",
    "    for item in city_data:\n",
    "        city_id = item['cityId']\n",
    "        city_id_get_cinema_information.apply_async(args=[city_id, version], queue=conf.MQ_SPIDER)\n",
    "    datas_cleanse.apply_async(args=['cinema', version], queue=conf.MQ_SPIDER, countdown=30)\n",
    "    cinema_id_fetch_schedule.apply_async(args=[version], queue=conf.MQ_SPIDER, countdown=60)\n",
    "    return ['city_id_fetch function is ok']\n",
    "city_id_fetch_schedule()"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.6.0"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
